import{A as p}from"./config-q41jkIlp.js";import{s as n,a as E,t as v}from"./mode-DIhV9zwq.js";async function L(){const e=document.getElementById("username").value.trim(),t=document.getElementById("password").value;if(!e||!t){n("Preencha usuário e senha!","error");return}try{const s=await fetch(`${p}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});let o={};try{o=await s.json()}catch{}if(!s.ok){n(o.message||o.error||`Erro ${s.status}: ${s.statusText}`,"error");return}if(o.success||o.user){n("Login realizado com sucesso!","success"),o.token&&localStorage.setItem("token",o.token),o.user&&(localStorage.setItem("username",o.user.username),localStorage.setItem("isMaster",o.user.isMaster));const u=window.location.hostname.includes("github.io")?"/RPG":"";window.location.href=o.user&&o.user.isMaster?`${u}/src/pages/master.html`:`${u}/src/pages/student.html`}else n(o.message||"Usuário ou senha inválidos.","error")}catch{n("Erro de conexão com o servidor.","error")}}const f=document.getElementById("forgotPasswordBtn"),r=document.getElementById("forgotPasswordModal"),g=document.getElementById("closeForgotModal"),a=document.getElementById("sendResetLinkBtn"),l=document.getElementById("forgotEmail");f&&f.addEventListener("click",e=>{e.preventDefault(),r.classList.remove("hidden"),r.classList.add("flex")});g&&g.addEventListener("click",()=>{r.classList.add("hidden"),r.classList.remove("flex"),l.value=""});a&&a.addEventListener("click",async()=>{const e=l.value.trim();if(!e){n("Digite seu email!","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){n("Email inválido!","error");return}a.disabled=!0,a.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';try{const t=await fetch(`${p}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),s=await t.json();t.ok?(n("Link de recuperação enviado! Confira seu email.","success"),r.classList.add("hidden"),r.classList.remove("flex"),l.value=""):n(s.error||"Erro ao enviar email de recuperação","error")}catch{n("Erro de conexão com o servidor","error")}finally{a.disabled=!1,a.innerHTML='<i class="fas fa-paper-plane mr-2"></i>Enviar Link de Recuperação'}});const i=document.getElementById("loginButton"),c=document.querySelector(".logo-icon"),h=document.getElementById("login-screen"),y=document.querySelectorAll("#login-screen .input-field, .input-group .input-field");function d(){document.querySelectorAll("#login-screen .input-icon, .input-group .input-icon").forEach(t=>{Object.assign(t.style,{position:"absolute",left:"18px",top:"26px",transform:"translateY(-50%)",color:"#6b7280",fontSize:"16px",width:"16px",height:"16px",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:"1000",transition:"color 0.3s ease",lineHeight:"1",margin:"0",padding:"0"})})}function m(){y.forEach(e=>{Object.assign(e.style,{height:"52px",lineHeight:"20px",padding:"16px 16px 16px 52px",boxSizing:"border-box",transform:"none"})})}d();m();y.forEach(e=>{const t=e.nextElementSibling;e.addEventListener("focus",()=>{e.style.paddingLeft="52px",t&&t.classList.contains("input-icon")&&(t.style.color="#667eea")}),e.addEventListener("blur",()=>{t&&t.classList.contains("input-icon")&&(t.style.color="#6b7280")}),["input","change"].forEach(s=>{e.addEventListener(s,()=>{m(),d()})})});h&&new MutationObserver(()=>{setTimeout(()=>{m(),d()},10)}).observe(h,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]});c&&c.addEventListener("click",()=>{c.classList.add("rolling"),c.addEventListener("animationend",()=>{c.classList.remove("rolling")},{once:!0})});i&&i.addEventListener("click",async()=>{i.classList.add("btn-loading"),await L(),i.classList.remove("btn-loading")});["username","password"].forEach(e=>{const t=document.getElementById(e);t&&i&&t.addEventListener("keypress",s=>{s.key==="Enter"&&i.click()})});function b(){const e=document.documentElement,t=document.getElementById("theme-icon");e.getAttribute("data-theme")==="dark"?(e.removeAttribute("data-theme"),e.classList.remove("dark"),localStorage.setItem("theme","light"),t&&(t.className="fas fa-moon theme-icon-moon")):(e.setAttribute("data-theme","dark"),e.classList.add("dark"),localStorage.setItem("theme","dark"),t&&(t.className="fas fa-sun theme-icon-sun"))}function w(){const e=localStorage.getItem("theme")||"light",t=document.documentElement,s=document.getElementById("theme-icon");e==="dark"?(t.setAttribute("data-theme","dark"),t.classList.add("dark"),s&&(s.className="fas fa-sun theme-icon-sun")):(t.removeAttribute("data-theme"),t.classList.remove("dark"),s&&(s.className="fas fa-moon theme-icon-moon"))}window.toggleTheme=b;w();E();window.toggleTheme=v;window.togglePasswordVisibility=function(e,t){const s=document.getElementById(e),o=t.querySelector("i");s.type==="password"?(s.type="text",o.classList.remove("fa-eye"),o.classList.add("fa-eye-slash")):(s.type="password",o.classList.remove("fa-eye-slash"),o.classList.add("fa-eye"))};
